<div class="container mt-4">
  <div class="row justify-content-center align-items-center">
    <div class="col-md-8">
      <!-- Tabs Navigation -->
      <!-- <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
          <a class="nav-link" 
             [class.active]="activeTab === 'profile'" 
             (click)="setActiveTab('profile')" 
             style="cursor: pointer;">
            <i class="bi bi-person me-1"></i> Profile
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" 
             [class.active]="activeTab === 'password'" 
             (click)="setActiveTab('password')"
             style="cursor: pointer;">
            <i class="bi bi-key me-1"></i> Change Password
          </a>
        </li>
      </ul> -->

      <!-- Profile Tab Content -->
      <div *ngIf="activeTab === 'profile'" class="card">
        <div class="card-header">
          <h4 class="mb-0">Profile Information</h4>
        </div>
        <div class="card-body">
          <form [formGroup]="profileForm" (ngSubmit)="onProfileSubmit()">
            <!-- Profile Image -->
            <div class="text-center mb-4">
              <div class="position-relative d-inline-block">
                <img [src]="profileImagePreview || userProfile?.profile_url || 'assets/images/default-avatar.png'" 
                     alt="Profile" 
                     class="rounded-circle" 
                     style="width: 120px; height: 120px; object-fit: cover; border: 3px solid #e9ecef;">
                <label class="btn btn-sm btn-primary position-absolute bottom-0 end-0 rounded-circle" 
                       style="width: 36px; height: 36px; line-height: 24px;">
                  <i class="bi bi-camera"></i>
                  <input type="file" 
                         class="d-none" 
                         accept="image/*" 
                         (change)="onFileSelected($event)">
                </label>
              </div>
              <div *ngIf="profileFormControls['profile_url'].touched && profileFormControls['profile_url'].errors" class="text-danger small mt-2">
                {{ profileFormControls['profile_url'].errors['required'] ? 'Profile image is required' : '' }}
              </div>
            </div>
            
            <!-- Profile form fields -->
            <div class="mb-3">
              <label for="name" class="form-label">Full Name</label>
              <input type="text" class="form-control" id="name" formControlName="name"
                [class.is-invalid]="profileFormControls['name'].touched && profileFormControls['name'].errors">
              <div *ngIf="profileFormControls['name'].touched && profileFormControls['name'].errors"
                class="invalid-feedback">
                <div *ngIf="profileFormControls['name'].errors?.['required']">Name is required</div>
              </div>
            </div>

            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" formControlName="email"
                [class.is-invalid]="profileFormControls['email'].touched && profileFormControls['email'].errors">
              <div *ngIf="profileFormControls['email'].touched && profileFormControls['email'].errors"
                class="invalid-feedback">
                <div *ngIf="profileFormControls['email'].errors?.['required']">Email is required</div>
                <div *ngIf="profileFormControls['email'].errors?.['email']">Please enter a valid email</div>
              </div>
            </div>


            <div class="d-flex justify-content-end">
              <button type="submit" class="btn btn-primary" [disabled]="profileForm.invalid || isLoading">
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                {{ isLoading ? 'Saving...' : 'Save Changes' }}
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Change Password Tab Content -->
      <div *ngIf="activeTab === 'password'" class="card">
        <div class="card-header">
          <h4 class="mb-0">Change Password</h4>
        </div>
        <div class="card-body">
          <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()">
            <div class="mb-3 password-input-group">
              <label for="currentPassword" class="form-label">Current Password</label>
              <div class="input-group">
                <input [type]="showCurrentPassword ? 'text' : 'password'" class="form-control" id="currentPassword"
                  formControlName="currentPassword"
                  [class.is-invalid]="passwordFormControls['currentPassword'].touched && passwordFormControls['currentPassword'].errors">
                <button type="button" class="password-toggle" (click)="showCurrentPassword = !showCurrentPassword">
                  <i class="bi" [class.bi-eye]="!showCurrentPassword" [class.bi-eye-slash]="showCurrentPassword"></i>
                </button>
              </div>
              <div
                *ngIf="passwordFormControls['currentPassword'].touched && passwordFormControls['currentPassword'].errors"
                class="invalid-feedback">
                <div *ngIf="passwordFormControls['currentPassword'].errors?.['required']">Current password is required
                </div>
              </div>
            </div>

            <div class="mb-3 password-input-group">
              <label for="newPassword" class="form-label">New Password</label>
              <div class="input-group">
                <input [type]="showNewPassword ? 'text' : 'password'" class="form-control" id="newPassword"
                  formControlName="newPassword"
                  [class.is-invalid]="passwordFormControls['newPassword'].touched && passwordFormControls['newPassword'].errors">
                <button type="button" class="password-toggle" (click)="showNewPassword = !showNewPassword">
                  <i class="bi" [class.bi-eye]="!showNewPassword" [class.bi-eye-slash]="showNewPassword"></i>
                </button>
              </div>
              <div *ngIf="passwordFormControls['newPassword'].touched && passwordFormControls['newPassword'].errors"
                class="invalid-feedback">
                <div *ngIf="passwordFormControls['newPassword'].errors?.['required']">New password is required</div>
                <div *ngIf="passwordFormControls['newPassword'].errors?.['minlength']">Password must be at least 8
                  characters long</div>
                <div *ngIf="passwordFormControls['newPassword'].errors['passwordStrength']">
                  {{ passwordFormControls['newPassword'].errors['passwordStrength'] }}
                </div>
              </div>
              <div class="form-text">
                Password must be at least 8 characters long and include at least one uppercase letter, one lowercase
                letter, one number, and one special character.
              </div>
            </div>

            <div class="mb-3 password-input-group">
              <label for="confirmPassword" class="form-label">Confirm New Password</label>
              <div class="input-group">
                <input [type]="showConfirmPassword ? 'text' : 'password'" class="form-control" id="confirmPassword"
                  formControlName="confirmPassword"
                  [class.is-invalid]="(passwordForm.touched || passwordForm.dirty) && passwordForm.errors?.['passwordMismatch']">
                <button type="button" class="password-toggle" (click)="showConfirmPassword = !showConfirmPassword">
                  <i class="bi" [class.bi-eye]="!showConfirmPassword" [class.bi-eye-slash]="showConfirmPassword"></i>
                </button>
              </div>
              <div *ngIf="(passwordForm.touched || passwordForm.dirty) && passwordForm.errors?.['passwordMismatch']"
                class="invalid-feedback">
                Passwords do not match
              </div>
            </div>

            <div class="d-flex justify-content-end">
              <button type="submit" class="btn btn-primary" [disabled]="passwordForm.invalid || isPasswordLoading">
                <span *ngIf="isPasswordLoading" class="spinner-border spinner-border-sm me-2"></span>
                {{ isPasswordLoading ? 'Updating...' : 'Change Password' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>